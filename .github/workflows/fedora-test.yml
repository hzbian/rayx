name: Fedora Test

on:
  workflow_dispatch:

jobs:
  build-and-release:
    name: Build and Release
    runs-on: ${{ matrix.os }}
    container: ${{ matrix.label == 'fedora' && 'fedora:latest' || null }}
    strategy:
      matrix:
        include:

          # ----------------------
          # Fedora build (RPM + TGZ)
          # ----------------------
          - os: ubuntu-latest        # GitHub runners for containers must be Ubuntu
            build-type: Release
            label: fedora

    steps:
      # ------------------------------------------------------------------
      # FEDORA SECTION (container-based)
      # ------------------------------------------------------------------
      - name: Install build deps (Fedora)
        if: matrix.label == 'fedora'
        run: |
          dnf install -y git cmake gcc gcc-c++ make ninja-build \
            dbus-devel gtk3-devel \
            hdf5 hdf5-devel \
            vulkan-loader vulkan-headers

      # ------------------------------------------------------------------
      # Standard checkout (works in bare Linux + Windows + Fedora container)
      # ------------------------------------------------------------------
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Detect Fedora version
        if: matrix.label == 'fedora'
        run: |
          echo "FEDORA_VERSION=$(rpm -E %fedora)"
